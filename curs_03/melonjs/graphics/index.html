<!DOCTYPE html>
<html>
    <head>
        <title>melonJS - Graphics drawing</title>
        <link rel="stylesheet" type="text/css" media="screen" href="index.css">
    </head>
    <body bgcolor="white">
        <!-- Canvas placeholder -->
        <div id="screen"></div>
        <!-- script -->
        <script type="module">

            import * as me from "https://esm.run/melonjs";

            me.device.onReady(function onReady() {
                // Initialize the video.
                if (!me.video.init(1024, 768, {parent : "screen", renderer : me.video.CANVAS, preferWebGL1 : false, blendMode: "normal"})) {
                    alert("Your browser does not support HTML5 canvas.");
                    return;
                }

                class Graphics extends me.Renderable {
                    // constructor
                    constructor() {
                        super(0, 0, me.game.viewport.width, me.game.viewport.height);

                        this.starMask = new me.Polygon(300, 70, [
                            // draw a star
                            {x: 0, y: 0},
                            {x: 14, y: 30},
                            {x: 47, y: 35},
                            {x: 23, y: 57},
                            {x: 44, y: 90},
                            {x: 0, y: 62},
                            {x: -44, y: 90},
                            {x: -23, y: 57},
                            {x: -47, y: 35},
                            {x: -14, y: 30}
                        ]);

                        this.polymask = new me.Polygon(0, 0, [
                            {x: 155, y: 77},
                            {x: 105, y: 77},
                            {x: 80, y: 120},
                            {x: 105, y: 163},
                            {x: 155, y: 163},
                            {x: 180, y: 120}
                        ]);

                        this.starMask.scale(4.0);
                        this.polymask.scale(4.0);

                        this.circleMask = new me.Ellipse(630 + 50, 520 + 50, 200, 200);

                        this.stripe1 = new me.Polygon(0, 0, [
                            {x: 0, y: 40},
                            {x: 0, y: 0},
                            {x: 40, y: 0}
                        ]);
                        this.stripe2 = new me.Polygon(0, 0, [
                            {x: 0, y: 40},
                            {x: 40, y: 0},
                            {x: 60, y: 0},
                            {x: 0, y: 60},

                        ]);
                        this.stripe3 = new me.Polygon(0, 0, [
                            {x: 0, y: 60},
                            {x: 60, y: 0},
                            {x: 80, y: 0},
                            {x: 0, y: 80},
                        ]);

                        this.roundRect1 = new me.RoundRect(100, 500, 400, 220, 4);
                        this.roundRect2 = new me.RoundRect(105, 505, 390, 210, 4);

                        this.rrect1Tween = new me.Tween(this.roundRect1).to({ radius: 100 }, {
                              duration: 1000,
                              easing: me.Tween.Easing.Linear.None,
                              yoyo: true,
                              repeat: Infinity,
                              autoStart : true
                        });
                        this.rrect2Tween = new me.Tween(this.roundRect2).to({ radius: 100 }, {
                              duration: 1000,
                              easing: me.Tween.Easing.Linear.None,
                              yoyo: true,
                              repeat: Infinity,
                              autoStart : true
                        });

                        // a temporary color object
                        this.color = new me.Color();

                        this.anchorPoint.set(0, 0);
                    }

                    update() {
                        return true;
                    }

                    // draw function
                    draw(renderer) {
                        renderer.clearColor("#FFFFFF");

                        renderer.setGlobalAlpha(1.0);

                        // draw 3 stripes
                        this.color.parseHex("#55aa00");
                        renderer.setColor(this.color);
                        renderer.fill(this.stripe1);
                        renderer.setColor("#ffcc00");
                        // lerp from the the starting color and the current renderer one
                        renderer.setColor(this.color.lerp(renderer.getColor(), 0.5));
                        renderer.fill(this.stripe2);
                        renderer.setColor("#ffcc00");
                        renderer.fill(this.stripe3);

                        renderer.setColor("#ffcc00");
                        renderer.setGlobalAlpha(0.375);
                        this.polymask.rotate(0.05, this.polymask.getBounds().center);
                        renderer.setMask(this.polymask);
                        renderer.fill(this.polymask.getBounds());
                        renderer.clearMask();

                        renderer.setColor("#55aa00");
                        renderer.fill(this.starMask);
                        renderer.setGlobalAlpha(0.5);
                        renderer.stroke(this.starMask);
                        renderer.fill(this.starMask.getBounds());
                        renderer.setGlobalAlpha(1.0);
                        renderer.stroke(this.starMask.getBounds());

                        renderer.setGlobalAlpha(0.5);

                        renderer.setColor("#e15d55");
                        renderer.strokeArc(740, 200, 110, Math.PI, 0 );
                        renderer.fillArc(740, 200, 110, 0, Math.PI);

                        renderer.setColor("#00aa88");
                        renderer.translate(25, 0);
                        renderer.setMask(this.circleMask);
                        renderer.fillRect(580, 470, 200, 200);
                        renderer.strokeEllipse(630 + 50, 520 + 50, 70, 70);
                        renderer.strokeRect(600, 490, 160, 160);
                        renderer.clearMask();

                        renderer.setColor("#ff69b4");
                        renderer.fill(this.roundRect1);
                        renderer.setColor("#ff1493");
                        renderer.stroke(this.roundRect2);
                    }
                };

                me.game.world.addChild(new Graphics());
            });
        </script>
    </body>
</html>
